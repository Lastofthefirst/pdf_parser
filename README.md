# Flatten Marker Output

This Rust application processes PDF files and their corresponding JSON representations, filtering out non-content elements and extracting plain text from HTML content to create a flattened, clean representation of the document content.

For use on pdf's processed by Marker with the following command:

 `marker_single --use_llm --gemini_api_key ______ --output_format json`


(if you dont specify output format as json marker also produces another json but its structure is full of unnesseccary information and doesnt correspond to the structure this flattener expects.)

## Features

- Processes individual PDF files or directories of PDFs
- Converts PDFs to JSON using the Marker library (Python-based)
- Filters out non-content elements:
  - Page container blocks
  - Header and footer blocks
  - Polygon and bounding box coordinates
  - Nested children structures
- Flattens document structure to a single-level array of content blocks
- Preserves important content elements like text, images, tables, etc.

## Installation

1. Make sure you have Rust installed (https://www.rust-lang.org/)
2. Install the required Python dependencies:
   ```bash
   pip install marker-pdf
   ```

3. Build the Rust application:
   ```bash
   cargo build --release
   ```

## Usage

```bash
# Process a single JSON file
./target/release/flatten_marker_output document.json

# Process a single PDF file
./target/release/flatten_marker_output document.pdf

# Process a directory of PDF files
./target/release/flatten_marker_output /path/to/pdf/directory

# Specify custom output directory
./target/release/flatten_marker_output document.json -o /path/to/output
```

## JSON Processing

The application takes a JSON representation of a document (generated by Marker) and performs the following transformations:

1. **Flattens the structure**: Removes the hierarchical page structure and creates a flat array of all content blocks.

2. **Filters content blocks**: Removes blocks that don't contain meaningful content:
   - Page blocks (containers only)
   - Header blocks
   - Footer blocks
   - Picture blocks (images)
   - List group blocks
   - Document blocks (top-level containers)

3. **Strips unnecessary data**: Removes fields that are not needed for content analysis:
   - Polygon coordinates
   - Bounding box coordinates
   - Nested children structures
   - Section hierarchy information
   - Images data

4. **Extracts plain text**: Extracts plain text content from HTML markup for easier text processing.

5. **Outputs simplified structure**: Outputs a top-level array of filtered blocks without any wrapper object.

## Output

The processed JSON will be saved in the same directory as the input file, with `_processed` appended to the filename, unless a custom output directory is specified with the `-o` flag.

The output will be a JSON array of content blocks:
```json
[
  {
    "id": "/page/0/Text/1",
    "block_type": "Text",
    "html": "<p>Document content here</p>",
    "text": "Document content here"
  },
  // ... more content blocks
]
```
```

## Block Types

The following block types are preserved in the output:
- Text
- SectionHeader
- Table
- Handwriting
- Equation
- ListItem
- TableOfContents
- And others that contain meaningful content

The following block types are removed:
- Page (containers only)
- PageHeader
- PageFooter
- Picture
- ListGroup